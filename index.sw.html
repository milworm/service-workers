<html>
<head>
    <meta charset="UTF-8">
    <title>With Service Workers</title>
    <link rel="manifest" href="/manifest.json">
    
    <!-- <link rel="stylesheet" href="/css/app.css?build=<buildno></buildno>" />
    <script src="/js/app.js?build=<buildno></buildno>"></script> -->
    <link rel="stylesheet" href="/css/app.css" />
    <script src="/js/app.js"></script>
    <script>
      navigator.serviceWorker.register('/sw.js')
      .then(function(registration) {
        return registration.pushManager.subscribe({
          userVisibleOnly: true
        });
      })
      .then(function(sub) {
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/api/subscribe', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onstatechange = function() {
          console.log(xhr.responseText);
        }
        xhr.send(JSON.stringify({
          user_id: 1,
          user_token: sub.endpoint.split('gcm/send/')[1]
        }));
      });
    </script>
</head>
<body>
</body>
</html>